<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Spring  设计模式" />





  <link rel="alternate" href="/atom.xml" title="一叶知秋" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Spring5源码解析-Spring中的处理器handlers
Spring Web应用程序的中心站是DispatcherServlet(具体请查看Spring5源码解析-论Spring DispatcherServlet的生命周期)。这是所有传入请求的中心入口。但如果没有但如果没有众多的handlers，我们依然不能做任何事情。

首先，在本文中，我们先解读handler到底是个啥。之后，我们将">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring5源码解析-Spring中的处理器handlers">
<meta property="og:url" content="https://muyinchen.github.io/2017/08/05/Spring5源码解析-Spring中的处理器handlers/index.html">
<meta property="og:site_name" content="一叶知秋">
<meta property="og:description" content="Spring5源码解析-Spring中的处理器handlers
Spring Web应用程序的中心站是DispatcherServlet(具体请查看Spring5源码解析-论Spring DispatcherServlet的生命周期)。这是所有传入请求的中心入口。但如果没有但如果没有众多的handlers，我们依然不能做任何事情。

首先，在本文中，我们先解读handler到底是个啥。之后，我们将">
<meta property="og:updated_time" content="2017-08-10T04:45:53.154Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring5源码解析-Spring中的处理器handlers">
<meta name="twitter:description" content="Spring5源码解析-Spring中的处理器handlers
Spring Web应用程序的中心站是DispatcherServlet(具体请查看Spring5源码解析-论Spring DispatcherServlet的生命周期)。这是所有传入请求的中心入口。但如果没有但如果没有众多的handlers，我们依然不能做任何事情。

首先，在本文中，我们先解读handler到底是个啥。之后，我们将">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://muyinchen.github.io/2017/08/05/Spring5源码解析-Spring中的处理器handlers/"/>


  <title> Spring5源码解析-Spring中的处理器handlers | 一叶知秋 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=UA-83014983-1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">一叶知秋</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule" rel="section">
            
            日程
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Spring5源码解析-Spring中的处理器handlers
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-05T23:50:00+08:00" content="2017-08-05">
              2017-08-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/基础/" itemprop="url" rel="index">
                    <span itemprop="name">基础</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/08/05/Spring5源码解析-Spring中的处理器handlers/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/08/05/Spring5源码解析-Spring中的处理器handlers/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-user"> 本站访客数 </i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>人次
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Spring5源码解析-Spring中的处理器handlers"><a href="#Spring5源码解析-Spring中的处理器handlers" class="headerlink" title="Spring5源码解析-Spring中的处理器handlers"></a>Spring5源码解析-Spring中的处理器handlers</h2><blockquote>
<p>Spring Web应用程序的中心站是<code>DispatcherServlet</code>(具体请查看<a href="https://muyinchen.github.io/2017/08/02/Spring5%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-%E8%AE%BASpring%20DispatcherServlet%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">Spring5源码解析-论Spring DispatcherServlet的生命周期</a>)。这是所有传入请求的中心入口。但如果没有但如果没有众多的handlers，我们依然不能做任何事情。</p>
</blockquote>
<p>首先，在本文中，我们先解读<code>handler</code>到底是个啥。之后，我们将介绍一些<code>Spring</code>框架中<code>handlers</code>的两种处理类型。最后我们加点<code>salt</code>来让我们学的东西进行落地，我们将编写我们自己的handler。<br><a id="more"></a></p>
<h2 id="Spring中的两种handler类型"><a href="#Spring中的两种handler类型" class="headerlink" title="Spring中的两种handler类型"></a>Spring中的两种handler类型</h2><p>首先，在Spring的世界中，这些<code>handler</code>到底做了些什么。简单的讲，这个就和我们听到一句话或者看到某个场景，然后有相关的反应是一样的，由很多处理最后转换到我们大脑皮层所能理解的东西。从机器语言的角度就是词法分析，语法分析，好咯，大家知道编译语言的重要性也就是基础的重要性了吧，回到框架中来，对于Spring来讲，这些处理程序就是一种将用户操作转换为Spring可以理解的元素。说到<code>用户操作</code>，我们可以考虑像<code>http://xxx.com/login</code>这样的URL类型。而我们的<code>handler</code>，在这里作为翻译处理，将尝试找到为此地址应该调用哪个控制器来处理。通常我们写<code>Spring controller</code>代码都知道，处理程序可以查找<code>@RequestMapping</code>的注解，并检查哪些映射与<code>/login</code> 这个URL匹配。由上一篇文章我们可以知道，这个处理程序将在<code>DispatcherServlet</code>的内被调用。</p>
<p>更准确地说，Spring中存在两种类型的handlers。第一种是<strong>handler mappings(处理程序映射)</strong>。它们的角色定位与前面所描述的功能完全相同。它们尝试将当前请求与相应的<code>controller</code>以及其中的方法相匹配。第二种是<strong>handler adapter(处理器适配器)</strong>。<code>handler adapter</code>从<code>handler mappings</code>中获取映射的<code>controllers</code> 和方法并调用它们。这种类型的适配器必须实现<strong>org.springframework.web.servlet.HandlerAdapter</strong>接口，它只有3种方法： </p>
<ul>
<li><strong>boolean supports(Object handler)</strong>:检查传入参数的对象是否可以由此适配器处理 </li>
<li><strong>ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) </strong>: 将请求翻译成视图。</li>
<li><strong>long getLastModified(HttpServletRequest request, Object handler)</strong>:返回给定<code>HttpServletRequest</code>的最后修改日期，以毫秒为单位。</li>
</ul>
<p>但这里要注意的是，在Spring版本中有一些重要变化。作为<code>DefaultAnnotationHandlerMapping</code>，<code>AnnotationMethodHandlerAdapter</code>或<code>AnnotationMethodHandlerExceptionResolver</code>的处理程序适配器自Spring 3.2版本以来已经废弃，在<code>Spring4.x</code>里还可以看到，在<code>Spring5</code>内已经删除掉了，替代品为<code>RequestMappingHandlerMapping</code>，<code>RequestMappingHandlerAdapter</code>和<code>ExceptionHandlerExceptionResolver</code>。通过这些新类以便于自定义映射。另外，通过在<code>since 3.1</code> 版本中<strong>org.springframework.web.method.HandlerMethod</strong>类中引入，来将所处理的对象转换为其方法表示。我们可以通过这个方法来判断对象返回的类型或者哪些参数是我们所期望的(看着拗口的话请打开源码查看此类注释)。</p>
<h2 id="Spring框架中的handler"><a href="#Spring框架中的handler" class="headerlink" title="Spring框架中的handler"></a>Spring框架中的handler</h2><p>除了已经提供的处理程序适配器之外，Spring也有本地处理程序映射，最基本的处理程序映射器是<strong>org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping</strong>类。它将<code>URL</code>与相应的bean进行匹配。例如，请看下面的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"/friends"</span> <span class="attr">class</span>=<span class="string">"com.waitingforcode.controller.FriendsController"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>正如你所看到的，这种配置在很多URL的情况下是很不实用的。一些更灵活的处理映射器是<strong>org.springframework.web.servlet.handler.SimpleUrlHandlerMapping</strong>。而不是为每个请求创建<code>bean</code>，我们可以创建一个映射文件，其中包含URL作为键和<code>controller</code>作为值，看下面的配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"simpleUrlMapping"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;</span> </div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappings"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"/friends.html"</span>&gt;</span>FriendsController<span class="tag">&lt;/<span class="name">props</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>但是，在<code>SimpleUrlHandlerMapping</code>中，处理稍微复杂URL也是一个头疼的问题。这也是为什么我们要用<code>DefaultAnnotationHandlerMapping</code>或者在最新的<code>Spring</code>版本中使用</p>
<p><code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</code>的</p>
<p>原因。它们的映射检测是基于注解。这样，所有的逻辑都保留在Java代码这块，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FriendsController</span> </span>&#123;</div><div class="line">     </div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/friends.html"</span>, method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showFriendsList</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"friendsListView"</span>;</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/friends/potential-friends.html"</span> method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showPotentialFriends</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"potentialFriendsView"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>与以前的处理程序不同的是，基于注解允许更灵活的配置。不仅不需要在<code>XML</code>进行各种繁琐的配置，一旦<code>URL</code>很多的情况下，想象一下<code>XML</code>,各种头大，现在通过注解，我们可以把一条路上不同岔口的<code>URL</code>在一个<code>controller</code>里进行接收处理就好。当配置文件中定义<code>&lt;mvc:annotation-driven/&gt;</code>时，此处理程序将被激活。另外，为了更细粒度的处理<code>controller</code>注解，我们可以通过添加<code>&lt;context:annotation-config /&gt;</code>(有后面这个之后此处也可以省略，后者本身 就具有此功能)和<code>&lt;context:component-scan base-package =“path.with.my.services.and.controllers”/&gt;</code>来启用它们。</p>
<h2 id="编写自定义的Spring-handler程序"><a href="#编写自定义的Spring-handler程序" class="headerlink" title="编写自定义的Spring handler程序"></a>编写自定义的Spring handler程序</h2><p>现在我们更深入了解一下Spring mapping handlers。我们来实现个我们自己的URL处理程序。其实很简单(因为只需要达到最基本的处理目的就可以了) ，我们将替换<code>RequestMappingHandlerMapping</code>，并使一个简单的映射器来处理URL地址。我们的映射器将只处理静态URL，如:<code>/home.html</code>。它无须也无法从方法签名中获取动态参数以及也无须知道<code>@PathVariable</code>元素。主要目标是让大家从中发现Spring处理一个请求所进行的步骤。</p>
<p>我们这个<code>handler</code>将扩展<code>RequestMappingHandlerMapping</code>并覆盖其方法(有些方法可以从<code>RequestMappingInfoHandlerMapping</code>找到，其实就是重写或实现<code>AbstractHandlerMethodMapping</code>里的几个抽象方法)： </p>
<ul>
<li><strong>protected void registerHandlerMethod(Object handler，Method method，RequestMappingInfo mapping)</strong>: </li>
<li><p><strong>protected boolean isHandler(Class beanType)</strong>: 检查bean是否符合给定处理程序的条件。 </p>
</li>
<li><p><strong>protected RequestMappingInfo getMappingForMethod(Method method，Class handlerType)</strong>: 为给定的Method实例提供映射的方法，该方法表示处理的方法（例如，使用<code>@RequestMapping</code>注解的<code>controller</code>的方法上所对应的<code>URL</code>）。</p>
</li>
</ul>
<ul>
<li><strong>protected HandlerMethod handleNoMatch(Set requestMappingInfos, String lookupPath, HttpServletRequest request)</strong> : 在给定的<code>HttpServletRequest</code>对象找不到匹配的处理方法时被调用。  </li>
<li><strong>protected void handleMatch(RequestMappingInfo info, String lookupPath, HttpServletRequest request)</strong> : 当为给定的<code>HttpServletRequest</code>对象找到匹配的处理方法时调用。</li>
</ul>
<p>在写这个<code>handler</code>之前，让我们写个自定义的<code>@RequestMapping</code>的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(ElementType.METHOD)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DumberRequestMapping &#123;</div><div class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>唯一的属性是代表<code>URL路径</code>的值，与<code>@RequestMapping</code>注解中的<code>value属性</code>完全相同。现在我们可以传入我们的处理程序映射类。该课程在内部进行评论。这就是为什么它不会在通常的“文本模式”中包含任何补充评论。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DumberRequestHandlerMapping</span> <span class="keyword">extends</span> <span class="title">RequestMappingHandlerMapping</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(DumberRequestHandlerMapping.class);</div><div class="line">     </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Checks if handler should be applied to given bean's class. The check is made through looking for DumberRequestMapping annotation.</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHandler</span><span class="params">(Class&lt;?&gt; beanType)</span> </span>&#123;</div><div class="line">        Method[] methods = ReflectionUtils.getAllDeclaredMethods(beanType);</div><div class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</div><div class="line">            <span class="keyword">if</span> (AnnotationUtils.findAnnotation(method, DumberRequestMapping.class) != <span class="keyword">null</span>) &#123;</div><div class="line">                LOGGER.debug(<span class="string">"[DumberRequestHandlerMapping] Method "</span>+method+<span class="string">" supports @DumberRequestMapping "</span>);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Make some operations directly before returning HttpServletRequest instance into mapped controller's method. For example, if you add here some attributes to this object, those attributes will be reachable from controller's method which handles the request. </div><div class="line">     * RequestMappingInfoHandlerMapping does some of more complicated stuff here like exposing URI template variables or extracting </div><div class="line">     * "matrix variable".</div><div class="line">     * NOTE : "matrix variables" are name-value pairs within path segments, separated with a semicolon (;). For example in this URL </div><div class="line">     * /clubs;country=France;division=Ligue 1, Ligue 2) we can find 2 matrix variables: country (France) and division (list composed by </div><div class="line">     * Ligue 1 and Ligue 2)</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleMatch</span><span class="params">(RequestMappingInfo info, String lookupPath, HttpServletRequest request)</span> </span>&#123;</div><div class="line">        LOGGER.debug(<span class="string">"[DumberRequestHandlerMapping] handleMatch info "</span>+info+  <span class="string">", lookupPath ="</span>+ lookupPath + <span class="string">", request ="</span>+request);</div><div class="line">        request.setAttribute(<span class="string">"isDumber"</span>, <span class="keyword">true</span>);</div><div class="line">        request.setAttribute(<span class="string">"handledTime"</span>, System.nanoTime());</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Method invoked when given lookupPath doesn't match with this handler mapping.</div><div class="line">     * Native RequestMappingInfoHandlerMapping uses this method to launch two exceptions : </div><div class="line">     * - HttpRequestMethodNotSupportedException - if some URLs match, but no theirs HTTP methods.</div><div class="line">     * - HttpMediaTypeNotAcceptableException - if some URLs match, but no theirs content types. For example, a handler can match an URL </div><div class="line">     * like /my-page/test, but can expect that the request should be send as application/json. Or, the handler can match the URL but </div><div class="line">     * returns an inappropriate response type, for example: text/html instead of application/json.</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> HandlerMethod <span class="title">handleNoMatch</span><span class="params">(Set&lt;RequestMappingInfo&gt; requestMappingInfos, String lookupPath, HttpServletRequest request)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">        LOGGER.debug(<span class="string">"[DumberRequestHandlerMapping] handleNoMatch info "</span>+requestMappingInfos+  <span class="string">", lookupPath ="</span>+ lookupPath + <span class="string">", request ="</span>+request);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Here we constructs RequestMappingInfo instance for given method.</div><div class="line">     * RequestMappingInfo - this object is used to encapsulate mapping conditions. For example, it contains an instance of </div><div class="line">     * PatternsRequestCondition which  is used in native Spring's RequestMappingInfoHandlerMapping  handleMatch() method to put URI </div><div class="line">     * variables into <span class="doctag">@RequestMapping</span> pattern. </div><div class="line">     * Ie, it will take the following URL /test/1 and match it for URI template /test/&#123;id&#125;. In occurrence, it will found that 1 </div><div class="line">     * corresponding to <span class="doctag">@PathVariable</span> represented  by id variable (&#123;id&#125;) and will set its value to 1.</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> RequestMappingInfo <span class="title">getMappingForMethod</span><span class="params">(Method method, Class&lt;?&gt; handlerType)</span> </span>&#123;</div><div class="line">        LOGGER.debug(<span class="string">"[DumberRequestHandlerMapping] getMappingForMethod method "</span>+method+  <span class="string">", handlerType ="</span>+handlerType);</div><div class="line">        RequestMappingInfo info = <span class="keyword">null</span>;</div><div class="line">        <span class="comment">// look for @DumberRequestMapping annotation for the Method method from signature</span></div><div class="line">        DumberRequestMapping methodAnnotation = AnnotationUtils.findAnnotation(method, DumberRequestMapping.class);</div><div class="line">        <span class="keyword">if</span> (methodAnnotation != <span class="keyword">null</span>) &#123;</div><div class="line">            RequestCondition&lt;?&gt; methodCondition = getCustomMethodCondition(method);</div><div class="line">            info = createRequestMappingInfo(methodAnnotation, methodCondition);</div><div class="line">        &#125;</div><div class="line">        LOGGER.debug(<span class="string">"[DumberRequestHandlerMapping] getMappingForMethod method; returns info mapping "</span>+info);</div><div class="line">        <span class="keyword">return</span> info;</div><div class="line">    &#125;</div><div class="line">     </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates RequestMappingInfo object which encapsulates:</div><div class="line">     * - PatternsRequestCondition: represents URI template to resolve. Resolving is helped by UrlPathHelper utility class from</div><div class="line">     * package org.springframework.web.util.</div><div class="line">     * - RequestMethodsRequestCondition: methods accepted by this handler. You can make a test and replace RequestMethod.GET by </div><div class="line">     * RequestMethod.POST. You will able to observe that our test won't work.</div><div class="line">     * - ParamsRequestCondition: </div><div class="line">     * - HeadersRequestCondition: headers which should be send in request to given handler should handle this request. You can,</div><div class="line">     * for exemple, put there an header value like "my-header:test" and observe the program behavior.</div><div class="line">     * - ConsumesRequestCondition: this condition allows to specify the content-type of request. We can use it for, for example,</div><div class="line">     * specify that a method can be handled only for application/json request.</div><div class="line">     * - ProducesRequestCondition: this condition allows to specify the content-type of response. We can use it for, for example,</div><div class="line">     * specify that a method can be applied only for text/plain response. </div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> RequestMappingInfo <span class="title">createRequestMappingInfo</span><span class="params">(DumberRequestMapping annotation, RequestCondition&lt;?&gt; customCondition)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RequestMappingInfo(</div><div class="line">                <span class="keyword">new</span> PatternsRequestCondition(<span class="keyword">new</span> String[] &#123;annotation.value()&#125;),</div><div class="line">                <span class="keyword">new</span> RequestMethodsRequestCondition(<span class="keyword">new</span> RequestMethod[]&#123;RequestMethod.GET&#125;),</div><div class="line">                <span class="keyword">new</span> ParamsRequestCondition(<span class="keyword">new</span> String[]&#123;&#125;),</div><div class="line">                <span class="keyword">new</span> HeadersRequestCondition(<span class="keyword">new</span> String[] &#123;&#125;),</div><div class="line">                <span class="keyword">new</span> ConsumesRequestCondition(<span class="keyword">new</span> String[]&#123;&#125;, <span class="keyword">new</span> String[]&#123;&#125;),</div><div class="line">                <span class="keyword">new</span> ProducesRequestCondition(<span class="keyword">new</span> String[]&#123;&#125;, <span class="keyword">new</span> String[]&#123;&#125;, getContentNegotiationManager()),</div><div class="line">                customCondition);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们需要向我们的应用程序上下文添加新的<code>HandlerMapping</code>。请看下面这个基于XML的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.mypackage.handler.DumberRequestHandlerMapping"</span>&gt;</span>//此处根据自己的包进行配置</div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"order"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>请注意，order属性的存在确定了按顺序将请求由<code>HandlerMapping</code>处理。在这里，如果<code>DumberRequestHandlerMapping</code>可以应用于一个请求，Spring将立即使用它，而不需要寻找另一个可用的处理程序。</p>
<p>最后一件事是使用<code>@DumberRequestMapping</code>在方法上添加注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</div><div class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(TestController.class);</div><div class="line">    <span class="meta">@DumberRequestMapping</span>(value = <span class="string">"/test"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testSession</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</div><div class="line">        LOGGER.debug(<span class="string">"Is dumber request ?"</span>+request.getAttribute(<span class="string">"isDumber"</span>));</div><div class="line">        LOGGER.debug(<span class="string">"Handled time ?"</span>+request.getAttribute(<span class="string">"handledTime"</span>));</div><div class="line">        <span class="keyword">return</span> <span class="string">"testTemplate"</span>;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过执行<code>http://localhost:8084/test</code>，您将看到在<code>DumberRequestHandlerMapping</code>的<code>handleMatch</code>方法中设置的请求的属性存在。如果您部署有应用程序的日志，您将看到有关controller执行流程的一些信息：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">027</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [org<span class="variable">.springframework</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.mvc</span><span class="variable">.method</span><span class="variable">.annotation</span><span class="variable">.RequestMappingHandlerMapping</span>]-[DEBUG] Looking up handler method <span class="keyword">for</span> path /test   <span class="comment">//先在RequestMappingHandlerMapping找的，也就是先找有@RequestMapping注解相应处理逻辑的方法来处理</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">028</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [org<span class="variable">.springframework</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.mvc</span><span class="variable">.method</span><span class="variable">.annotation</span><span class="variable">.RequestMappingHandlerMapping</span>]-[DEBUG] Did <span class="keyword">not</span> find handler method <span class="keyword">for</span> [/test]   <span class="comment">//在RequestMappingHandlerMapping中没找到相应的处理逻辑</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">028</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [com<span class="variable">.migo</span><span class="variable">.sso</span><span class="variable">.DumberRequestHandlerMapping</span>]-[DEBUG] Looking up handler method <span class="keyword">for</span> path /test</div><div class="line">  <span class="comment">//从DumberRequestHandlerMapping里找，发现@DumberRequestMapping所注解的方法可以处理，那就处理咯</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">029</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [com<span class="variable">.migo</span><span class="variable">.sso</span><span class="variable">.DumberRequestHandlerMapping</span>]-[DEBUG] [DumberRequestHandlerMapping] handleMatch info &#123;[/test],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]&#125;, lookupPath =/test, request =org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.connector</span><span class="variable">.RequestFacade</span>@<span class="number">24</span>a7274b</div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">030</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [com<span class="variable">.migo</span><span class="variable">.sso</span><span class="variable">.DumberRequestHandlerMapping</span>]-[DEBUG] Returning handler method [public java<span class="variable">.lang</span><span class="variable">.String</span> com<span class="variable">.migo</span><span class="variable">.sso</span><span class="variable">.controller</span><span class="variable">.TestController</span><span class="variable">.testSession</span>(javax<span class="variable">.servlet</span><span class="variable">.http</span><span class="variable">.HttpServletRequest</span>)]</div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">030</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.DefaultListableBeanFactory</span>]-[DEBUG] Returning cached <span class="keyword">instance</span> of singleton bean 'testController'</div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">030</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [org<span class="variable">.springframework</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.DispatcherServlet</span>]-[DEBUG] Last-Modified value <span class="keyword">for</span> [/test] is: -<span class="number">1</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">040</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [com<span class="variable">.migo</span><span class="variable">.sso</span><span class="variable">.controller</span><span class="variable">.TestController</span>]-[DEBUG] Is dumber request ?true</div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">05</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">040</span> [http-bio-<span class="number">8084</span>-exec-<span class="number">1</span>] [com<span class="variable">.migo</span><span class="variable">.sso</span><span class="variable">.controller</span><span class="variable">.TestController</span>]-[DEBUG] Handled <span class="keyword">time</span> ?<span class="number">21230126522470</span></div><div class="line">Handled <span class="keyword">time</span> ?<span class="number">17452005683775</span></div></pre></td></tr></table></figure>
<p>我们可以看到， handler mapping是Spring生态系统中的一个关键概念。所有的URL都由对应的处理程序处理，由此，Spring可以匹配传入的HTTP请求和所加注解配置的controller的方法。我们也看到了如何根据不同规则来过滤请求，例如：Content-Type，Accept或其他headers 或HTTP方法。我们还编写了一个poor版本的Spring的<code>RequestMappingInfoHandlerMapping</code>，它拦截一些URL处理并将结果通过视图输出给用户。</p>
<p>总结起来就是，通过一定的方式确定相应请求的处理位置(我们通常通过注解来确定)，仅此而已，啰嗦了太多的东西，最后也就是如此的直白</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://og0sybnix.bkt.clouddn.com/wechat-qcode.png" alt="知秋 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spring/" rel="tag">#Spring</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/02/Spring5源码解析-论Spring DispatcherServlet的生命周期/" rel="next" title="Spring5源码解析-论Spring DispatcherServlet的生命周期">
                <i class="fa fa-chevron-left"></i> Spring5源码解析-论Spring DispatcherServlet的生命周期
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/07/Spring5源码解析-Spring中的处理拦截器/" rel="prev" title="Spring5源码解析-Spring中的处理拦截器">
                Spring5源码解析-Spring中的处理拦截器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/08/05/Spring5源码解析-Spring中的处理器handlers/"
           data-title="Spring5源码解析-Spring中的处理器handlers" data-url="https://muyinchen.github.io/2017/08/05/Spring5源码解析-Spring中的处理器handlers/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://og0sybnix.bkt.clouddn.com/18213496.jpg"
               alt="知秋" />
          <p class="site-author-name" itemprop="name">知秋</p>
          <p class="site-description motion-element" itemprop="description">只记空山，只念新雨</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">72</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/lsgqjh" title="小舒哥" target="_blank">小舒哥</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring5源码解析-Spring中的处理器handlers"><span class="nav-number">1.</span> <span class="nav-text">Spring5源码解析-Spring中的处理器handlers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring中的两种handler类型"><span class="nav-number">2.</span> <span class="nav-text">Spring中的两种handler类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring框架中的handler"><span class="nav-number">3.</span> <span class="nav-text">Spring框架中的handler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写自定义的Spring-handler程序"><span class="nav-number">4.</span> <span class="nav-text">编写自定义的Spring handler程序</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">知秋</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhiqiuyy"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

  


</body>
</html>
